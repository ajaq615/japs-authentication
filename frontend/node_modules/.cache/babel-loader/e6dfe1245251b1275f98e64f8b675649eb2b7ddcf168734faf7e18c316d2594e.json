{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.getCookieParser = getCookieParser;\nexports.sendStatusCode = sendStatusCode;\nexports.redirect = redirect;\nexports.checkIsManualRevalidate = checkIsManualRevalidate;\nexports.clearPreviewData = clearPreviewData;\nexports.sendError = sendError;\nexports.setLazyProp = setLazyProp;\nexports.SYMBOL_CLEARED_COOKIES = exports.SYMBOL_PREVIEW_DATA = exports.RESPONSE_LIMIT_DEFAULT = exports.COOKIE_NAME_PRERENDER_DATA = exports.COOKIE_NAME_PRERENDER_BYPASS = exports.PRERENDER_REVALIDATE_ONLY_GENERATED_HEADER = exports.PRERENDER_REVALIDATE_HEADER = void 0;\nfunction getCookieParser(headers) {\n  return function parseCookie() {\n    const header = headers.cookie;\n    if (!header) {\n      return {};\n    }\n    const {\n      parse: parseCookieFn\n    } = require(\"next/dist/compiled/cookie\");\n    return parseCookieFn(Array.isArray(header) ? header.join(\";\") : header);\n  };\n}\nfunction sendStatusCode(res, statusCode) {\n  res.statusCode = statusCode;\n  return res;\n}\nfunction redirect(res, statusOrUrl, url) {\n  if (typeof statusOrUrl === \"string\") {\n    url = statusOrUrl;\n    statusOrUrl = 307;\n  }\n  if (typeof statusOrUrl !== \"number\" || typeof url !== \"string\") {\n    throw new Error(`Invalid redirect arguments. Please use a single argument URL, e.g. res.redirect('/destination') or use a status code and URL, e.g. res.redirect(307, '/destination').`);\n  }\n  res.writeHead(statusOrUrl, {\n    Location: url\n  });\n  res.write(url);\n  res.end();\n  return res;\n}\nconst PRERENDER_REVALIDATE_HEADER = \"x-prerender-revalidate\";\nexports.PRERENDER_REVALIDATE_HEADER = PRERENDER_REVALIDATE_HEADER;\nconst PRERENDER_REVALIDATE_ONLY_GENERATED_HEADER = \"x-prerender-revalidate-if-generated\";\nexports.PRERENDER_REVALIDATE_ONLY_GENERATED_HEADER = PRERENDER_REVALIDATE_ONLY_GENERATED_HEADER;\nfunction checkIsManualRevalidate(req, previewProps) {\n  return {\n    isManualRevalidate: req.headers[PRERENDER_REVALIDATE_HEADER] === previewProps.previewModeId,\n    revalidateOnlyGenerated: !!req.headers[PRERENDER_REVALIDATE_ONLY_GENERATED_HEADER]\n  };\n}\nconst COOKIE_NAME_PRERENDER_BYPASS = `__prerender_bypass`;\nexports.COOKIE_NAME_PRERENDER_BYPASS = COOKIE_NAME_PRERENDER_BYPASS;\nconst COOKIE_NAME_PRERENDER_DATA = `__next_preview_data`;\nexports.COOKIE_NAME_PRERENDER_DATA = COOKIE_NAME_PRERENDER_DATA;\nconst RESPONSE_LIMIT_DEFAULT = 4 * 1024 * 1024;\nexports.RESPONSE_LIMIT_DEFAULT = RESPONSE_LIMIT_DEFAULT;\nconst SYMBOL_PREVIEW_DATA = Symbol(COOKIE_NAME_PRERENDER_DATA);\nexports.SYMBOL_PREVIEW_DATA = SYMBOL_PREVIEW_DATA;\nconst SYMBOL_CLEARED_COOKIES = Symbol(COOKIE_NAME_PRERENDER_BYPASS);\nexports.SYMBOL_CLEARED_COOKIES = SYMBOL_CLEARED_COOKIES;\nfunction clearPreviewData(res) {\n  let options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  if (SYMBOL_CLEARED_COOKIES in res) {\n    return res;\n  }\n  const {\n    serialize\n  } = require(\"next/dist/compiled/cookie\");\n  const previous = res.getHeader(\"Set-Cookie\");\n  res.setHeader(`Set-Cookie`, [...(typeof previous === \"string\" ? [previous] : Array.isArray(previous) ? previous : []), serialize(COOKIE_NAME_PRERENDER_BYPASS, \"\", {\n    // To delete a cookie, set `expires` to a date in the past:\n    // https://tools.ietf.org/html/rfc6265#section-4.1.1\n    // `Max-Age: 0` is not valid, thus ignored, and the cookie is persisted.\n    expires: new Date(0),\n    httpOnly: true,\n    sameSite: process.env.NODE_ENV !== \"development\" ? \"none\" : \"lax\",\n    secure: process.env.NODE_ENV !== \"development\",\n    path: \"/\",\n    ...(options.path !== undefined ? {\n      path: options.path\n    } : undefined)\n  }), serialize(COOKIE_NAME_PRERENDER_DATA, \"\", {\n    // To delete a cookie, set `expires` to a date in the past:\n    // https://tools.ietf.org/html/rfc6265#section-4.1.1\n    // `Max-Age: 0` is not valid, thus ignored, and the cookie is persisted.\n    expires: new Date(0),\n    httpOnly: true,\n    sameSite: process.env.NODE_ENV !== \"development\" ? \"none\" : \"lax\",\n    secure: process.env.NODE_ENV !== \"development\",\n    path: \"/\",\n    ...(options.path !== undefined ? {\n      path: options.path\n    } : undefined)\n  })]);\n  Object.defineProperty(res, SYMBOL_CLEARED_COOKIES, {\n    value: true,\n    enumerable: false\n  });\n  return res;\n}\nclass ApiError extends Error {\n  constructor(statusCode, message) {\n    super(message);\n    this.statusCode = statusCode;\n  }\n}\nexports.ApiError = ApiError;\nfunction sendError(res, statusCode, message) {\n  res.statusCode = statusCode;\n  res.statusMessage = message;\n  res.end(message);\n}\nfunction setLazyProp(_ref, prop, getter) {\n  let {\n    req\n  } = _ref;\n  const opts = {\n    configurable: true,\n    enumerable: true\n  };\n  const optsReset = {\n    ...opts,\n    writable: true\n  };\n  Object.defineProperty(req, prop, {\n    ...opts,\n    get: () => {\n      const value = getter();\n      // we set the property on the object to avoid recalculating it\n      Object.defineProperty(req, prop, {\n        ...optsReset,\n        value\n      });\n      return value;\n    },\n    set: value => {\n      Object.defineProperty(req, prop, {\n        ...optsReset,\n        value\n      });\n    }\n  });\n}","map":{"version":3,"names":["getCookieParser","sendStatusCode","redirect","checkIsManualRevalidate","clearPreviewData","sendError","setLazyProp","headers","parseCookie","header","cookie","parse","parseCookieFn","require","Array","isArray","join","res","statusCode","statusOrUrl","url","Error","writeHead","Location","write","end","PRERENDER_REVALIDATE_HEADER","PRERENDER_REVALIDATE_ONLY_GENERATED_HEADER","req","previewProps","isManualRevalidate","previewModeId","revalidateOnlyGenerated","COOKIE_NAME_PRERENDER_BYPASS","COOKIE_NAME_PRERENDER_DATA","RESPONSE_LIMIT_DEFAULT","SYMBOL_PREVIEW_DATA","Symbol","SYMBOL_CLEARED_COOKIES","options","arguments","length","undefined","serialize","previous","getHeader","setHeader","expires","Date","httpOnly","sameSite","process","env","NODE_ENV","secure","path","Object","defineProperty","value","enumerable","ApiError","constructor","message","statusMessage","_ref","prop","getter","opts","configurable","optsReset","writable","get","set"],"sources":["../../../src/server/api-utils/index.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}